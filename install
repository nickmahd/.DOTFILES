#!/bin/bash
# Nicholas Mahdavi
# nickmahda@gmail.com

cd "$(dirname "${BASH_SOURCE[0]}")" || exit 1

DIR=$(pwd)

git submodule init && git submodule update

for f in var zshrc gitconfig tmux.conf.local; do
  cmp --silent ~/."$f" "$f" && continue
  [ -e ~/."$f" ] && { mkdir -pv backup; mv -v ~/."$f" backup/"$f" }
  ln -sfv "$DIR/$f" ~/."$f"
done

cmp --silent ~/.tmux.conf tmux/.tmux.conf && continue
[ -e ~/.tmux.conf ] && mv -v ~/.tmux.conf backup/.tmux.conf
ln -sfv "$DIR/tmux/.tmux.conf" ~/.tmux.conf

[ -e ~/.bash_profile ] && { mkdir -pv backup; mv -v ~/.bash_profile backup/bash_profile }
echo -e "if [ -f ~/.bashrc ]; then\n    source ~/.bashrc\nfi" > ~/.bash_profile

[ -e ~/.bashrc ] && { mkdir -pv backup; mv -v ~/.bashrc backup/bashrc }
echo -e "if [ -f ~/.var ]; then\n    source ~/.var\nfi" > ~/.bashrc

[ -d ~/.zsh ] && mv -v ~/.zsh backup/zsh
ln -sfv "$DIR/zsh" ~/.zsh

sudo ln -sfv $PWD/powerlevel10k/powerlevel10k.zsh-theme /usr/local/share/zsh/site-functions/prompt_powerlevel10k_setup

if [[ "$OSTYPE" == "darwin"* ]]; then
    if [ -z "$(which brew)" ]; then
        ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
    fi

    sudo chown -R $(whoami) $(brew --prefix)/*

    brew install cmake coreutils emacs gcc gnu-chess htop nano nginx opencv pkg-config python tmux tree vim zsh

    # brew cask install google-chrome discord eqmac firefox flux gimp inkscape iterm2 java opera-neon osxfuse selfcontrol spotify the-unarchiver xquartz virtualbox visual-studio-code vnc-viewer

    cp Blex\ Mono\ Nerd\ Font\ Complete.ttf ~/Library/Fonts/

    /usr/local/bin/pip3 install flask pandas praw jupyter virtualenv scikit-learn scikit-plot scikit-image prawcore numpy scipy beautifulsoup4 urllib3

elif [[ "$OSTYPE" == "linux"* ]]; then
    sudo apt install emacs gnuchess htop pkg-config python3-dev tmux zsh
    echo "You may have to compile vim from scratch to work with this .vimrc."

    cp $DIR/Blex Mono Nerd Font Complete.ttf ~/.fonts/
    fc-cache -fv

    /usr/bin/pip3 install flask pandas praw jupyter virtualenv scikit-learn scikit-plot scikit-image prawcore numpy scipy beautifulsoup4 urllib3

fi

cd $DIR/zsh

echo "Moving to vim install"

cd $DIR
./viminstall
