#!/bin/bash
# Nicholas Mahdavi
# nickmahda@gmail.com

cd "$(dirname "${BASH_SOURCE[0]}")" || exit 1

DIR=$(pwd)

git submodule init && git submodule update

for f in var *rc *profile gitconfig; do
  mkdir -pv backup
  [ -e ~/."$f" ] && mv -v ~/."$f" backup/."$f"
  ln -sfv "$DIR/$f" ~/."$f"
done

[ -d ~/.zsh ] && mv -v ~/.zsh backup/zsh
ln -sfv "$DIR/zsh" ~/.zsh

if [[ "$OSTYPE" == "darwin"* ]]; then
    if [ -z "$(which brew)" ]; then
        ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
    fi

    sudo chown -R $(whoami) $(brew --prefix)/*

    brew install cmake coreutils emacs gcc gnu-chess htop nano nginx opencv pkg-config python tmux tree vim zsh
    brew cask install google-chrome discord eqmac firefox gimp inkscape java opera-neon osxfuse spotify xquartz virtualbox

    ITERM_PATH=~/Library/Application\ Support/iTerm2

    mkdir $ITERM_PATH
    [ -d $ITERM_PATH/ITERM_PREFS ] && mv -k $ITERM_PATH/ITERM_PREFS backup/ITERM_PREFS
    ln -sfv $DIR/ITERM_PREFS $ITERM_PATH/ITERM_PREFS

    ln -sfv $DIR/Blex Mono Nerd Font Complete.ttf ~/Library/Fonts/

else if [[ "$OSTYPE" == "linux"* ]]; then
    sudo apt install emacs gnuchess htop pkg-config python3-dev tmux zsh
    echo "You may have to compile vim from scratch to work with this .vimrc."

    cp $DIR/Blex Mono Nerd Font Complete.ttf ~/.fonts/
    fc-cache -fv
fi

cd zsh

sudo ln -sfv $PWD/powerlevel10k/powerlevel10k.zsh-theme /usr/local/share/zsh/site-functions/prompt_powerlevel10k_setup

cd tmux

for f in .tmux*; do
    [ -e ~/"$f" ] && mv -v ~/"$f" backup/"$f"
    ln -sfv "$DIR/tmux/$f" ~/"$f"
done

echo "Moving to vim install"

cd $DIR
./viminstall
