#!/bin/bash
# Nicholas Mahdavi
# nickmahda@gmail.com

cd "$(dirname "${BASH_SOURCE[0]}")" || exit 1

DIR=`pwd`

git submodule init && git submodule update

for f in var *rc *profile gitconfig; do
  mkdir -pv backup
  [ -e ~/."$f" ] && mv -v ~/."$f" backup/."$f"
  ln -sfv "$DIR/$f" ~/."$f"
done

[ -d ~/.zsh ] && mv -v ~/.zsh backup/zsh
ln -sfv "$DIR/zsh" ~/.zsh

ln -sfv "$DIR/zsh/pure.zsh" /usr/local/share/zsh/site-functions/prompt_pure_setup
ln -sfv "$DIR/zsh/async.zsh" /usr/local/share/zsh/site-functions/async

ITERM_PATH=~/Library/Application\ Support/iTerm2

mkdir $ITERM_PATH
[ -d $ITERM_PATH/ITERM_PREFS ] && mv -k $ITERM_PATH/ITERM_PREFS backup/ITERM_PREFS
ln -sfv $DIR/ITERM_PREFS $ITERM_PATH/ITERM_PREFS

cd tmux

for f in .tmux*; do
    [ -e ~/"$f" ] && mv -v ~/"$f" backup/"$f"
    ln -sfv "$DIR/tmux/$f" ~/"$f"
done

ln -sfv ./Blex Mono Nerd Font Complete.ttf ~/Library/Fonts/

if [[ "$OSTYPE" == "darwin"* ]]; then
    [ -z "$(which brew)" ] && ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

    brew install cmake coreutils emacs gcc gnu-chess htop nano nginx opencv pkg-config python tmux tree vim zsh zsh-history-substring-search
    brew cask install google-chrome discord eqmac firefox gimp inkscape java opera-neon osxfuse spotify xquartz virtualbox

fi

echo "Moving to vim install"

cd $DIR
./viminstall
